/*!
 * jQuery.selection - jQuery Plugin
 * Copyright (c) 2010-2012 IWASAKI Koji (@madapaja).
 * http://blog.madapaja.net/
 * Under The MIT License, http://opensource.org/licenses/MIT
 */
(function(e,t,n){var i=function(e){var i={text:"",start:0,end:0};if(!e.value)return i;try{if(t.getSelection)i.start=e.selectionStart,i.end=e.selectionEnd,i.text=e.value.slice(i.start,i.end);else if(n.selection){e.focus();var o=n.selection.createRange(),a=n.body.createTextRange();i.text=o.text;try{a.moveToElementText(e),a.setEndPoint("StartToStart",o)}catch(r){a=e.createTextRange(),a.setEndPoint("StartToStart",o)}i.start=e.value.length-a.text.length,i.end=i.start+o.text.length}}catch(r){}return i},o={getPos:function(e){var t=i(e);return{start:t.start,end:t.end}},setPos:function(e,n,i){i=this._caretMode(i),"start"==i?n.end=n.start:"end"==i&&(n.start=n.end),e.focus();try{if(e.createTextRange){var o=e.createTextRange();t.navigator.userAgent.toLowerCase().indexOf("msie")>=0&&(n.start=e.value.substr(0,n.start).replace(/\r/g,"").length,n.end=e.value.substr(0,n.end).replace(/\r/g,"").length),o.collapse(!0),o.moveStart("character",n.start),o.moveEnd("character",n.end-n.start),o.select()}else e.setSelectionRange&&e.setSelectionRange(n.start,n.end)}catch(a){}},getText:function(e){return i(e).text},_caretMode:function(e){switch(e=e||"keep",0==e&&(e="end"),e){case"keep":case"start":case"end":break;default:e="keep"}return e},replace:function(t,n,o){var a=i(t),r=t.value,s=e(t).scrollTop(),l={start:a.start,end:a.start+n.length};t.value=r.substr(0,a.start)+n+r.substr(a.end),e(t).scrollTop(s),this.setPos(t,l,o)},insertBefore:function(t,n,o){var a=i(t),r=t.value,s=e(t).scrollTop(),l={start:a.start+n.length,end:a.end+n.length};t.value=r.substr(0,a.start)+n+r.substr(a.start),e(t).scrollTop(s),this.setPos(t,l,o)},insertAfter:function(t,n,o){var a=i(t),r=t.value,s=e(t).scrollTop(),l={start:a.start,end:a.end};t.value=r.substr(0,a.end)+n+r.substr(a.end),e(t).scrollTop(s),this.setPos(t,l,o)}};e.extend({selection:function(i){var o="text"==(i||"text").toLowerCase();try{if(t.getSelection){if(o)return""+t.getSelection();var a,r=t.getSelection();return r.getRangeAt?a=r.getRangeAt(0):(a=n.createRange(),a.setStart(r.anchorNode,r.anchorOffset),a.setEnd(r.focusNode,r.focusOffset)),e("<div></div>").append(a.cloneContents()).html()}if(n.selection)return o?n.selection.createRange().text:n.selection.createRange().htmlText}catch(s){}return""}}),e.fn.extend({selection:function(e,t){switch(t=t||{},e){case"getPos":return o.getPos(this[0]);case"setPos":return this.each(function(){o.setPos(this,t)});case"replace":return this.each(function(){o.replace(this,t.text,t.caret)});case"insert":return this.each(function(){"before"==t.mode?o.insertBefore(this,t.text,t.caret):o.insertAfter(this,t.text,t.caret)});case"get":default:return o.getText(this[0])}return this}})})(jQuery,window,window.document);